<html>
	<body style="font-family:Arial,sans-serif; background:#f8f9fa; color:#222;">
		<div style="max-width:600px; margin:auto; background:#fff; border-radius:8px; box-shadow:0 2px 8px #0001; padding:2em;">
			<div style="background:#0a174e; border-radius:10px; padding:12px 18px; display:flex; align-items:center; gap:12px; margin-bottom:1.2rem;">
				<img src="https://konvix.com/img/konvixlogottblanc.png" alt="Konvix Technology" style="height:38px; width:auto; display:block; margin-right:12px;">
				<span style="color:#fff; font-size:1.15rem; font-weight:600; letter-spacing:0.5px; line-height:1.1;" class="mt-1">Confirmation de votre commande</span>
			</div>
			<div style="margin-bottom: 1rem;">
				{% if order is defined %}
					<strong>Numéro de commande :</strong>
					{{ order.id }}<br>
					<strong>Date de commande :</strong>
					{{ order.createdAt|date('d/m/Y H:i') }}<br>
					<strong>Transporteur :</strong>
					{{ order.transporteur }}<br>
					<strong>Frais de livraison :</strong>
					{{ order.fraisLivraison|number_format(2, ',', ' ') }}
					€
				{% else %}
					<strong>Commande test PayPal (pas d'ID)</strong><br>
					<strong>Date de commande :</strong>
					{{ "now"|date('d/m/Y H:i') }}<br>
					<strong>Transporteur :</strong>
					{{ transporteur.name|default('-') }}<br>
					<strong>Frais de livraison :</strong>
					{{ transporteur.price|number_format(2, ',', ' ') }}
					€
				{% endif %}
			</div>
			<p>Bonjour
				<strong>{{ user.firstname }}
					{{ user.lastname }}</strong>,</p>
			<p>Merci pour votre commande sur Konvix ! Voici le récapitulatif :</p>
			<h3>Détail de la commande</h3>
			<table style="width:100%; border-collapse:collapse; margin-bottom:1em;">
				<thead>
					<tr style="background:#f0f4fa;">
						<th align="left">Produit</th>
						<th align="right">Prix Unit.</th>
						<th align="right">Qté</th>
						<th align="right">Total</th>
					</tr>
				</thead>
				<tbody>
					{% set totalHT = 0 %}
					{% for item in cart %}
						<tr>
							<td>{{ item.product.name }}</td>
							<td align="right">{{ item.product.price|number_format(2, '.', ' ') }}
								€</td>
							<td align="right">{{ item.quantity }}</td>
							<td align="right">{{ (item.product.price * item.quantity)|number_format(2, '.', ' ') }}
								€</td>
						</tr>
						{% set totalHT = totalHT + (item.product.price * item.quantity) %}
					{% endfor %}
				</tbody>
				<tfoot>
					<tr>
						<td colspan="3" align="right" style="font-weight:bold;">Sous-total HT :</td>
						<td align="right">{{ (totalHT / 1.2)|number_format(2, '.', ' ') }}
							€</td>
					</tr>
					<tr>
						<td colspan="3" align="right" style="font-weight:bold;">TVA (20%) :</td>
						<td align="right">{{ (totalHT - (totalHT / 1.2))|number_format(2, '.', ' ') }}
							€</td>
					</tr>
					<tr>
						<td colspan="3" align="right" style="font-weight:bold;">Frais de livraison :</td>
						<td align="right">
							{% if order is defined %}
								{{ order.fraisLivraison|number_format(2, '.', ' ') }}
								€
							{% else %}
								{{ transporteur.price|number_format(2, '.', ' ') }}
								€
							{% endif %}
						</td>
					</tr>
					<tr style="background:#eaf7ea;">
						<td colspan="3" align="right" style="font-weight:bold; color:#0072ff;">Total TTC :</td>
						<td align="right" style="font-weight:bold; color:#0072ff;">
							{% if order is defined %}
								{{ (totalHT + order.fraisLivraison)|number_format(2, '.', ' ') }}
								€
							{% else %}
								{{ (totalHT + transporteur.price)|number_format(2, '.', ' ') }}
								€
							{% endif %}
						</td>
					</tr>
				</tfoot>
			</table>
			<h3>Adresse de livraison</h3>
			<div style="margin-bottom:1em;">
				<strong>{{ user.firstname }}
					{{ user.lastname }}</strong><br>
				{% if address is defined %}
					{{ address.address }}<br>
					{{ address.city }}<br>
					{{ address.zip }}
					{{ address.country }}<br>
					Tél :
					{{ address.phone }}
				{% else %}
					{{ user.address|default('') }}<br>
					{{ user.city|default('') }}<br>
					{{ user.postalCode|default('') }}
					{{ user.country|default('') }}<br>
					{% if user.phone is defined %}Tél :
						{{ user.phone }}
					{% endif %}
				{% endif %}
			</div>
			<h3>Expédition</h3>
			<div>
				{% if transporteur is defined %}
					Votre commande sera expédiée via
					<strong>{{ transporteur.name }}</strong>.
				{% else %}
					Votre commande test PayPal a bien été enregistrée.
				{% endif %}
			</div>
			<p style="margin-top:2em; color:#0072ff;">L’équipe Konvix vous remercie pour votre confiance.<br>Pour toute question, contactez-nous à serviceclient@konvix.com</p>
		</div>
	</body>
</html>
